<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulário Planejamento HE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background-color: #f9f9f9;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-group label {
            font-weight: bold;
        }

        .btn-roxo {
            background-color: #6a1b9a;
            color: white;
        }

        .btn-roxo:hover {
            background-color: #4a148c;
        }
    </style>
</head>

<body>
    <div class="container">
        <h3 class="text-center mb-4">Formulário de Planejamento de Horas Extras</h3>
        <form id="formPlanejamento" method="POST" action="/planejamento-he/enviar">
            <div class="form-group">
                <label for="gerente">Gerente:</label>
                <select id="gerente" name="gerente" class="form-control select2" required>
                    <option value="">Selecione</option>
                </select>
            </div>

            <div class="form-group">
                <label for="mes">Mês:</label>
                <select id="mes" name="mes" class="form-control" required>
                    <option value="Janeiro">Janeiro</option>
                    <option value="Fevereiro">Fevereiro</option>
                    <option value="Março">Março</option>
                    <option value="Abril">Abril</option>
                    <option value="Maio">Maio</option>
                    <option value="Junho">Junho</option>
                    <option value="Julho">Julho</option>
                    <option value="Agosto">Agosto</option>
                    <option value="Setembro">Setembro</option>
                    <option value="Outubro">Outubro</option>
                    <option value="Novembro">Novembro</option>
                    <option value="Dezembro">Dezembro</option>
                </select>
            </div>

            <div class="form-group">
                <label for="valorSimulacao">Valor Simulação:</label>
                <input type="text" id="valorSimulacao" name="valorSimulacao" class="form-control" readonly />
            </div>

            <div class="form-group">
                <label for="colaborador">Colaborador:</label>
                <select id="colaborador" name="colaborador" class="form-control select2" required>
                    <option value="">Selecione</option>
                </select>
            </div>

            <div class="form-group">
                <label for="cargo">Cargo:</label>
                <input type="text" id="cargo" name="cargo" class="form-control" readonly />
            </div>

            <div class="form-group">
                <label for="horas">Volume de Horas:</label>
                <input type="number" id="horas" name="horas" class="form-control" min="0" required />
            </div>

            <div class="form-group">
                <label for="justificativa">Justificativa:</label>
                <select id="justificativa" name="justificativa" class="form-control" required>
                    <option value="">Selecione</option>
                    <option value="Atendimento fora do horário">Atendimento fora do horário</option>
                    <option value="Demanda emergencial">Demanda emergencial</option>
                    <option value="Cobertura de ausência">Cobertura de ausência</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tipoHE">Tipo HE:</label>
                <select id="tipoHE" name="tipoHE" class="form-control" required>
                    <option value="50%">50%</option>
                    <option value="100%">100%</option>
                </select>
            </div>

            <div class="form-group">
                <label for="aprovacao">Aprovação:</label>
                <input type="text" id="aprovacao" name="aprovacao" class="form-control" value="PENDENTE APROVAÇÃO"
                    readonly />
            </div>

            <div class="form-group">
                <label for="enviadoPor">Enviado por:</label>
                <input type="text" id="enviadoPor" name="enviadoPor" class="form-control" readonly />
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-roxo">ENVIAR</button>
                <button type="reset" class="btn btn-secondary ml-2">LIMPAR</button>
            </div>
        </form>
    </div>

    <script>
        fetch('/home/usuario')
            .then(res => res.json())
            .then(data => {
                const nomeUsuario = data.email;
                const perfilUsuario = data.perfil;
                const acessos = data.acessos;

                document.getElementById('enviadoPor').value = nomeUsuario
                console.log(nomeUsuario)
            });
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Selecionar o mês atual
            const selectMes = document.getElementById('mes');
            const mesAtual = new Date().getMonth();
            selectMes.selectedIndex = mesAtual;

            const gerenteSelect = document.getElementById('gerente');
            const colaboradorSelect = document.getElementById('colaborador');
            const cargoInput = document.getElementById('cargo');

            //entes(sem Select2)
            fetch('/planejamento-he/api/gerentes')
                .then(response => response.json())
                .then(data => {
                    const gerentesOrdenados = data.gerentes.sort();
                    gerentesOrdenados.forEach(nome => {
                        const option = document.createElement('option');
                        option.value = nome;
                        option.textContent = nome;
                        gerenteSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar gerentes:', error);
                });

            // Carregar colaboradores com Select2
            gerenteSelect.addEventListener('change', function () {
                const gerenteSelecionado = gerenteSelect.value;
                colaboradorSelect.innerHTML = '<option value="">Selecione</option>';
                cargoInput.value = '';

                if (gerenteSelecionado) {
                    fetch(`/planejamento-he/api/colaboradores?gerente=${encodeURIComponent(gerenteSelecionado)}`)
                        .then(response => response.json())
                        .then(data => {
                            data.colaboradores.forEach(nome => {
                                const option = document.createElement('option');
                                option.value = nome;
                                option.textContent = nome;
                                colaboradorSelect.appendChild(option);
                            });

                            // Inicializa Select2 no campo de colaborador
                            $(colaboradorSelect).select2({
                                placeholder: "Selecione um colaborador",
                                allowClear: true
                            });
                        })
                        .catch(error => {
                            console.error('Erro ao carregar colaboradores:', error);
                        });
                }
            });


            $(document.getElementById('colaborador')).on('select2:select', function (e) {
                const nomeSelecionado = e.params.data.id;

                console.log("Colaborador selecionado via Select2:", nomeSelecionado);

                if (nomeSelecionado) {
                    fetch(`/planejamento-he/api/cargo?nome=${encodeURIComponent(nomeSelecionado)}`)
                        .then(response => response.json())
                        .then(data => {
                            console.log("Cargo recebido:", data);
                            document.getElementById('cargo').value = data.cargo || '';
                        })
                        .catch(error => {
                            console.error('Erro ao buscar cargo:', error);
                            document.getElementById('cargo').value = '';
                        });
                } else {
                    document.getElementById('cargo').value = '';
                }
            });

        });
    </script>

</body>

</html>